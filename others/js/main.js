// // In your Vue component or any JavaScript file
// function emitGlobalChatMessage(message) {
//   const event = new CustomEvent('chat-message-submit', {
//     detail: {
//       message: message,
//       timestamp: new Date()
//     }
//   });
//   window.dispatchEvent(event);
// }

// // Usage example:
// emitGlobalChatMessage('Hello world!');

// // In any other JavaScript file (Vue or non-Vue)
// window.addEventListener('chat-message-submit', (event) => {
//   console.log('Received chat message:', event.detail.message);
//   console.log('Timestamp:', event.detail.timestamp);
  
//   // Your handling code here
// });

// const path = require('path');
// const outputDir = path.join(__dirname, 'output');
// console.log('outputDir', outputDir);
// console.log('outputDir', __dirname, __filename);
// const s = "{\"sources\": [{\"url\": \"https://www.thegabba.com.au/whats-on\", \"title\": \"What's On\"}, {\"url\": \"https://thegabba.com.au/plan-your-visit/faqs\", \"title\": \"Frequently Asked Questions\"}]}";
// const obj = JSON.parse(s);
// console.log('obj', obj.sources[0].title);

const docs = [
    {
      pageContent: "Parking | Gabba Skip to the main content Parking Parking Parking Event Day Parking There is no public parking available at the Gabba. Parking restrictions apply in the local area on major event days. Street Parking Fifteen minute parking limits apply across most of The Gabba Traffic Area on event days - we strongly recommend taking advantage of public transport options. Find out more about parking restrictions around The Gabba on the Brisbane City Council website . Locals living in The Gabba Traffic Area can apply for a parking permit to gain exemption from area-wide parking limits. Coach Parking There is a limited amount of designated on-street parking zones for coaches on major event days at The Gabba. Coach operators MUST apply for a parking permit. Deadline: Applications for Coach Parking close 3 business days prior to the event. Coach passes will not be distributed until 48 hours prior to the event. Coach Parking Application PWD Drop Off and Parking Accessibility Drop Off: Near Gate 5 on Linton Street (near Duke St). Limited Accessibility Parking: Available across from Gate 5 on Duke St (PWD permit required, first come, first served). For more info, visit our Accessibility page. Accessibility Plan your journey The Gabba is a public transport venue and offers free shuttle bus services from the following locations on major event days: Brisbane City Carindale Chermside Eight Mile Plains To check shuttle bus timings please check the Translink website or use the journey planner to plan your trip. Translink Journey Planner Entering the Venue Stadiums Queensland acknowledges Aboriginal and Torres Strait Islander peoples as the First Australians and recognises their culture, history, diversity and deep connection to the Land, Seas and Waters of Queensland. We acknowledge the Traditional Custodians of the land upon which our venues stand, and pay our respects to Elders past, present, and future. Our Partners Address: The Gabba Vulture St Woolloongabba QLD 4102 (1300 THEGABBA) Phone number: 1300 843 422 Contact email address: info@thegabba.com.au What's On Getting Here Careers Members Contact Us  Stadiums Queensland Disclaimer | Privacy | Media Centre | Cookies | Copyright",
      metadata: {
        content_type: 'text/html;charset=utf-8',
        description: '',
        id: 'https://thegabba.com.au/plan-your-visit/parking',
        image: '',
        openurl: 'https://thegabba.com.au/plan-your-visit/parking',
        title: 'Parking'
      },
      id: undefined
    },
    {
      pageContent: "require a ticket. CAN I PARK AT THE GABBA? No. The Gabba is a public transport destination. There are no public car parks available on event days and fifteen minute parking limits apply across most of The Gabba Traffic Area from 7:00am till 10:00pm on event days. Find out more about parking restrictions around The Gabba on the Brisbane City Council website. IS THERE ACCESSIBILITY PARKING AT THE GABBA? There is no accessibility parking at The Gabba. There is an accessibility drop off point which is located on Duke Street opposite Gate 5 of The Gabba. View The Gabba Stadium Map to see this location. WHAT IS THE CLOSEST BUS STATION TO THE GABBA? Woolloongabba bus station is located directly adjacent to Gate 2 at The Gabba. There are also a number of other bus stops in The Gabba area. Visit Translink to plan your journey. IS THERE A TAXI RANK AT THE GABBA? The taxi rank is located on Ipswich Road. View The Gabba Stadium Map for more information. IS THERE A RIDE SHARE ZONE AT THE GABBA? The ride share drop off zone is located on Potts Street, East of the stadium. View The Gabba Stadium Map for more information. DO I GET FREE PUBLIC TRANSPORT WITH MY EVENT TICKET? Your event ticket includes FREE public transport to and from The Gabba on all regular Queensland Rail train services and Transport for Brisbane bus services, City Ferries are not included in free transport plan. You must have your event ticket to ride. Visit Translink to plan your journey. CAN I GET FREE PUBLIC TRANSPORT IF I HAVE NOT COLLECTED MY EVENT TICKETS YET? Patrons must be able to present a valid event day ticket to be entitled to the free public transport.  Patrons who choose to collect their tickets at the venue on an event day will only be entitled to a free return journey on public transport. HOW DO I APPLY FOR COACH PARKING? Coach operators MUST apply for a parking permit as there is limited capacity in designated on-street parking zones for coaches. Apply through the Coach Parking Application Form . WHERE CAN I BUY TICKETS FOR EVENTS AT THE GABBA? AFL events: Tickets for all AFL events held at The Gabba should only be purchased through Ticketmaster . All questions regarding AFL ticketing should be directed to Ticketmaster . Ticketmaster is the only authorised sellers of AFL tickets at the Gabba. Cricket events: Tickets for all Cricket events held at the Gabba should only be purchased through Ticketek . All questions regarding cricket ticketing should be directed to Ticketek . Ticketek in the only authorised sellers of cricket tickets at the Gabba. The Gabba has no obligation to honour tickets purchased from unauthorised re-sellers such as Viagogo, Ticketmaster Resale, Tickets, Ebay, Gumtree, Tickets Australia, Ticket Merchant, Ticket Blaster, Ticket Bis and Queenoftickets. CAN I BUY TICKETS AT THE GABBA ON THE EVENT DAY? Ticket offices will be open at The Gabba on event days, for enquires. Ticketing staff can also assist with purchasing tickets online. ARE THERE ALCOHOL-FREE SEATING OPTIONS? There are unlicensed seating options available at point of purchase from your ticketing agent: AFL Events: Ticketmaster Cricket Events: Ticketek I HAVE LOST MY TICKET. WHAT SHOULD I DO? AFL events: Keep a record of your transaction and account number to assist staff to quickly handle any query. Contact Ticketmaster on 136 100 before the event. If you lose your tickets on the way to the event, please see staff at any of the ticket offices located at the venue. Cricket Events: Ticketek will only replace lost, stolen, damaged or destroyed tickets if the authenticity of the ticket can be verified, including proof of purchase, and if you give reasonable notice before the event. Ticketek may charge a reasonable fee for the replacement of tickets. Ticketek may not replace tickets where seating is unallocated (general admission tickets). Find more information on Ticketek's Terms & Conditions of Sale webpage. DOES MY CHILD NEED A TICKET? Depending on the event you are attending,",
      metadata: {
        content_type: 'text/html;charset=utf-8',
        description: '',
        id: 'https://thegabba.com.au/plan-your-visit/faqs',
        image: '',
        openurl: 'https://thegabba.com.au/plan-your-visit/faqs',
        title: 'Frequently Asked Questions'
      },
      id: undefined
    },
    {
      pageContent: "Accessibility | Gabba Skip to the main content Accessibility Accessibility Accessibility Accessibility At The Gabba we are committed to delivering access to great events for everyone. This includes providing the following services for people with disability. Ticketing Cricket - Accessible Tickets For cricket events at the Gabba, accessible tickets can be purchased directly through Ticketek. You can also contact Ticketek's Accessible Ticket booking line on 1300 665 915 , (Mon - Fri, 9am -5pm) if you require additional support in completing your booking. Ticketek Accessibility AFL - Accessible Tickets For AFL events at the Gabba, accessible tickets can be purchsaed directly through Ticketmaster. You can also contact Ticketmaster on 1300 446 925 , to complete your purchase over the phone. Ticketmaster Accessibility Arrival Parking and drop off An accessibility drop off and parking zone is located near Gate 5 on Duke Street, between Vulture and Linton Streets. You will require PWD permit to access this area. Parks are first in, first served. More parking information Seating and Facilities All designated accessibility seating is located without the need to utilise the stairs, or is accessible via lifts. Please enter through the gate allocated on your ticket and see staff at the gate for direction on the best route to your seat. Toilets and Changing Places Accessible toilets are located throughout The Gabba. Please see the friendly event staff inside the venue to locate the closest accessible toilet to your designated seating location. The Gabba has an accredited Changing Places Facility for patrons with high support needs and their carers to access a change facility that provides additional space and specialised equipment to allow them to use toilets safely and comfortably. It features a full-sized change table, ceiling hoist and shower and located on level two adjacent to Gate 9 and is accessible on all event days. Changing Places Quiet Room The Gabba is an inclusive venue,  featuring a ‘Quiet Room’ - a highly absorbing, quiet and calm environment which can help to provide a calm and comfortable oasis for overactive and distressed individuals. The room includes sensory conscious games, quiet cubicles, tactile wall panels and bean bags to assist children and others who are overwhelmed in a stadium environment.  The room is located in a low traffic area, away from the busy stadium environment, on level 2 near Gate 4 and can be accessed on event days. During your visit to the Gabba, event staff can assist you with any questions you might have, if you get lost or need help locating the Quiet Room, look for the Gabba branded T-Shirts,  venue staff are well trained and are happy to help. Sensory bags, equipped with noise cancelling headphones and fidget tools, are available to any individual who may feel overwhelmed by the environement, which gives them the option to enjoy the show with their family or group. These are available to be borrowed from the First Aid Rooms at Gates 2, 4, 7 & 9. Social Story Plan Your Visit Stadiums Queensland acknowledges Aboriginal and Torres Strait Islander peoples as the First Australians and recognises their culture, history, diversity and deep connection to the Land, Seas and Waters of Queensland. We acknowledge the Traditional Custodians of the land upon which our venues stand, and pay our respects to Elders past, present, and future. Our Partners Address: The Gabba Vulture St Woolloongabba QLD 4102 (1300 THEGABBA) Phone number: 1300 843 422 Contact email address: info@thegabba.com.au What's On Getting Here Careers Members Contact Us  Stadiums Queensland Disclaimer | Privacy | Media Centre | Cookies | Copyright",
      metadata: {
        content_type: 'text/html;charset=utf-8',
        description: '',
        id: 'https://thegabba.com.au/plan-your-visit/accessibility',
        image: '',
        openurl: 'https://thegabba.com.au/plan-your-visit/accessibility',
        title: 'Accessibility'
      },
      id: undefined
    },
    {
      pageContent: "route to your seat. ARE ACCESSIBLE TOILETS AT THE GABBA? Accessible toilets are located throughout The Gabba. Please see the friendly event staff inside the venue to locate the closest accessible toilet to your designated seating location. IS THERE WHEELCHAIR ACCESS TO ALL SEATING AREAS? All designated accessible seating is located without the need to utilise the stairs, or is accessible via lifts. Please see the staff at your gate for the best accessible route to your seat. ARE THERE ACCESSIBILITY PARKING OR DROP OFF AREAS AT THE GABBA? There is no accessible parking at The Gabba. However, an accessible drop off point is located on Duke Street opposite Gate 5 of The Gabba. Please view The Gabba Stadium Map for more information. Events at The Gabba Stadiums Queensland acknowledges Aboriginal and Torres Strait Islander peoples as the First Australians and recognises their culture, history, diversity and deep connection to the Land, Seas and Waters of Queensland. We acknowledge the Traditional Custodians of the land upon which our venues stand, and pay our respects to Elders past, present, and future. Our Partners Address: The Gabba Vulture St Woolloongabba QLD 4102 (1300 THEGABBA) Phone number: 1300 843 422 Contact email address: info@thegabba.com.au What's On Getting Here Careers Members Contact Us  Stadiums Queensland Disclaimer | Privacy | Media Centre | Cookies | Copyright",
      metadata: {
        content_type: 'text/html;charset=utf-8',
        description: '',
        id: 'https://thegabba.com.au/plan-your-visit/faqs',
        image: '',
        openurl: 'https://thegabba.com.au/plan-your-visit/faqs',
        title: 'Frequently Asked Questions'
      },
      id: undefined
    },
    {
      pageContent: "Gabba Locals | Gabba Skip to the main content Gabba Locals Gabba Locals Gabba Locals Are you a Gabba local? The Gabba enjoys a close relationship with the local residents and businesses of the area. To keep up to date with events happening at The Gabba, visit our What's On page. What's On Subscribe For Locals Updates As a local, you are important to us, and we understand that events may impact you in a range of ways. So whether you live or work nearby, we want to keep you informed about what’s happening at your local Stadium. Sign up via this form and stay up to date. Local Resident Parking Permits Residential parking permits allow residents to park unrestricted on the street in their area, with certain conditions. Permit holders: Are exempt from the signed traffic area time limit when parking near their property; Must clearly display their permit on the vehicle's windscreen or dashboard; Are able to park in metered parking bays signed 'resident permit excepted' (free of charge with no time restriction); and May also park in other areas signed 'resident permit excepted' (with no time restriction). Permits do not allow residents to park in designated statutory restricted areas, such as: Clearway zones; Loading zones; No stopping zones; Bus zones; and Taxi zones. If you live within The Gabba traffic area, you can apply for a parking permit. Apply for a Parking Permit Stadiums Queensland acknowledges Aboriginal and Torres Strait Islander peoples as the First Australians and recognises their culture, history, diversity and deep connection to the Land, Seas and Waters of Queensland. We acknowledge the Traditional Custodians of the land upon which our venues stand, and pay our respects to Elders past, present, and future. Our Partners Address: The Gabba Vulture St Woolloongabba QLD 4102 (1300 THEGABBA) Phone number: 1300 843 422 Contact email address: info@thegabba.com.au What's On Getting Here Careers Members Contact Us  Stadiums Queensland Disclaimer | Privacy | Media Centre | Cookies | Copyright",
      metadata: {
        content_type: 'text/html;charset=utf-8',
        description: '',
        id: 'https://thegabba.com.au/about/locals',
        image: '',
        openurl: 'https://thegabba.com.au/about/locals',
        title: 'Gabba Locals'
      },
      id: undefined
    }
  ];

const answer = "There is no public parking available at The Gabba, and parking restrictions apply in the local area on major event days. Limited accessible parking is available near Gate 5 on Duke St (PWD permit required, first come, first served), and public transport is recommended. [STARTJSON]{\"sources\": [{\"url\": \"https://thegabba.com.au/plan-your-visit/parking\", \"title\": \"Parking\"}, {\"url\": \"https://thegabba.com.au/plan-your-visit/accessibility\", \"title\": \"Accessibility\"}]}[ENDJSON]";

// convert string text to object
const parseResponseMessage = (inputString) => {
    const result = {
      text: '',
      sources: [],
    }
    if (!inputString.includes('[STARTJSON]') && !inputString.includes('[ENDJSON]')) {
      // Sometimes the AI stuffs up and includes [ENDJSON]
      result.text = inputString.trim().replace('[ENDJSON]', '')
      return result;
    }
    const text = inputString.split('[STARTJSON]')[0].trim();
    const jsonStart = inputString.indexOf('[STARTJSON]') + '[STARTJSON]'.length;
    const jsonEnd = inputString.indexOf('[ENDJSON]');
    const jsonString = inputString.substring(jsonStart, jsonEnd).trim();
  
    let jsonData;
    try {
      jsonData = JSON.parse(jsonString);
    } catch (e) {
      console.error("Failed to parse JSON:", e);
    }
    result.text = text;
    result.sources = jsonData.sources || [];
    return result;
}

const parseMetaMessage = (meta, retrivedDocs) => {
    const sources = meta.sources;
    if (sources.length > 0 && retrivedDocs.length >= sources.length) {
        for (let i = 0; i < sources.length; i++) {
            retrivedDocs[i].metadata.title = sources[i].title;
            retrivedDocs[i].metadata.id = sources[i].url;
            retrivedDocs[i].metadata.openurl = sources[i].url;
        }
    }
    return retrivedDocs;
}

const metaFromPrompt = parseResponseMessage(answer);
const retrivedDocs = parseMetaMessage(metaFromPrompt, docs);

//   console.log('retrivedDocs', retrivedDocs);

objString = '{\"sources\": [{\"url\": \"https://thegabba.com.au/plan-your-visit/parking\", \"title\": \"Parking\"}, {\"url\": \"https://thegabba.com.au/plan-your-visit/accessibility\", \"title\": \"Accessibility\"}]}'
const metaFromPrompt2 = JSON.parse(objString);
console.log(metaFromPrompt2)
console.log(objString)